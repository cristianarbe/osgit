#!/bin/sh
# Copyright 2019 Cristian Ariza
# Licensed under the EUPL
#
# Self updater

set -eu

die(){
  echo "$1"
  exit 1
}

if test "$(id -u)" != 0; then
  die "This script must be run as root"
fi

remote_version="$(curl -s https://raw.githubusercontent.com/cristianrz/osgit/master/VERSION)"
if test -z "$remote_version"; then
  die 'could not find remote version'
fi

echo "Remote version is $remote_version"
local_version="$(osgit -v | sed 's/osgit//g')"
echo "Local version is $local_version"

printf "Do you want to update? [y/N] "
read -r response

if test "$response" != "y"; then
  die "aborted by the user"
fi

tmp="$(mktemp -d)"

git clone https://github.com/cristianrz/osgit "$tmp"

chmod +x "$tmp"/install

"$tmp"/install
