#!/bin/sh

set -eu

if test "$(id -u)" != 0; then
  echo "This script must be run as root"
  exit 1
fi

remote_version="$(curl -s https://raw.githubusercontent.com/cristianrz/osgit/master/VERSION)"
if test -z "$remote_version"; then
  echo 'could not find remote version'
  exit 1
fi

echo "Remote version is $remote_version"
local_version="$(osgit -v | sed 's/osgit//g')"
echo "Local version is $local_version"

printf "Do you want to update? [y/N] "
read -r response

if test "$response" != "y"; then
  echo "aborted by the user"
  exit 1
fi

tmp="$(mktemp -d)"
git clone https://github.com/cristianrz/osgit "$tmp"
cd "$tmp" || exit

chmod +x install
./install
